# Template: v3
# Bills

require ["include", "environment", "variables", "relational", "comparator-i;ascii-numeric", "spamtest", "fileinto", "imap4flags", "vnd.proton.expire", "extlists"];

# Generated: Do not run this script on spam messages
if allof (environment :matches "vnd.proton.spam-threshold" "*", spamtest :value "ge" :comparator "i;ascii-numeric" "${1}") {
    return;
}

# Guardian: Do not run if addressed to excluded mailboxes (e.g. new@, personal@)
if allof (not header :comparator "i;unicode-casemap" :contains "X-Original-To" ["new@", "personal@"], header :contains "Delivered-To" ["@"])
{

# --- GLOBAL RULES ---

# 1. F | Fileinto (Subject)
if anyof (
  header :comparator "i;unicode-casemap" :contains "Subject" ["Update Payment Info", "Statement is Ready", "New invoice posted", "Loan Statement is Ready", "Recurring Payment Setup", "Payment Accepted", "Payment Due Reminder", "natural gas video bill", "statement now", "Payment Information", "New Bill", "Baylor Scott & White", "Baylor Scott & White Health", "Baylor Scott", "Complete Cancellation", "Transaction decline", "recent billing statement", "monthly billing statement", "invoice posted", "your subscription", "billing information", "Don't lose your credits", "your escrow payment has", "upcoming autopay", "Cancellation Confirmation", "policy is all set", "Package updated", "Membership Will", "Subscription cancelled", "Subscription is", "Review your AT&T order", "backup payment", "grace period", "is About to Renew", "Invoice is", "Your Upcoming Mortgage Payment", "Subscription Canceled", "INVOICE", "your home insurance quotes", "Autopay Enrollment", "Payment declined", "Billing agreement cancellation", "enrolled in repeat payments", "Subscription Expiring Soon", "video bill", "Thank You for Subscribing", "New statement", "Statement is Ready", "Statement Ready", "Your Statement is Ready", "overdue", "Auto Pay", "past due", "payment has been scheduled", "payment is scheduled", "Action Required", "will be canceled", "Payment Was Rejected", "Bill", "payment will be", "charged to your card", "insurance bill", "scheduled payment reminder", "Your Statement is Ready for Viewing", "will renew", "online bill is", "credit on your next order", "expir"],
  header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
) {
  fileinto "Bills";
}

# 2. FR | Fileinto + Read (Subject)
if anyof (
  header :comparator "i;unicode-casemap" :contains "Subject" ["__IGNORE__"],
  header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
) {
  fileinto "Bills";
  addflag "\\Seen";
}

# 3. FRS | Fileinto + Read + Stop (Subject)
if anyof (
  header :comparator "i;unicode-casemap" :contains "Subject" ["__IGNORE__"],
  header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
) {
  fileinto "Bills";
  addflag "\\Seen";
  stop;
}

# 4. FRA | Fileinto + Read + Archive (Subject)
if anyof (
  header :comparator "i;unicode-casemap" :contains "Subject" ["__IGNORE__"],
  header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
) {
  fileinto "Bills";
  addflag "\\Seen";
  fileinto "archive";
}

# 5. FRAS | Fileinto + Read + Archive + Stop (Subject)
if anyof (
  header :comparator "i;unicode-casemap" :contains "Subject" ["Payment Accepted Email", "payment will be processed", "Statement is Ready", "Energy Bill is Available", "Utility Statement", "AT&T online bill is ready", "is ready for credit card", "view your statement", "Statement is Ready", "Statement Ready", "Your Statement is Ready", "Loan Statement is Ready", "Payment Accepted", "Cloudflare Invoice is Attached", "natural gas video bill", "most recent billing statement", "invoice posted to your account", "view your statement now", "Statement is Ready", "Payment Due Reminder", "service is cancelled", "was made", "recent billing statement", "monthly billing statement", "invoice posted", "Chariot", "Autopay", "is ready for", "bill is ready", "bill is available", "reminder", "payment reminder", "payment schedule", "payment is scheduled", "payment change", "requests $", "cancellation", "view", "all set", "AT&T online", "payment will be", "Ready for Viewing", "preschool", "Service Estimate - 202", "Card statement is ready"],
  header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
) {
  fileinto "Bills";
  addflag "\\Seen";
  fileinto "archive";
  stop;
}

# 6. from:FRS | Fileinto + Read + Stop (From)
if anyof (
  address :all :comparator "i;unicode-casemap" :contains ["From"] ["__IGNORE__"],
  address :all :comparator "i;unicode-casemap" :matches ["From"] ["__IGNORE__"]
) {
  fileinto "Bills";
  addflag "\\Seen";
  stop;
}

# 7. from:FRAS | Fileinto + Read + Archive + Stop (From)
if anyof (
  address :all :comparator "i;unicode-casemap" :contains ["From"] ["__IGNORE__"],
  address :all :comparator "i;unicode-casemap" :matches ["From"] ["__IGNORE__"]
) {
  fileinto "Bills";
  addflag "\\Seen";
  fileinto "archive";
  stop;
}

# 8. Fx1 | Fileinto + Expire 1 Day (Subject)
if anyof (
  header :comparator "i;unicode-casemap" :contains "Subject" ["__IGNORE__"],
  header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
) {
  fileinto "Bills";
  expire "day" "1";
  stop;
}

# --- SCOPED RULES (Applies only to mailbox: Bills) ---
if header :contains "X-Original-To" "bills" {

    # 9. Scoped F | Fileinto (Subject)
    if anyof (
      header :comparator "i;unicode-casemap" :contains "Subject" ["__IGNORE__"],
      header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
    ) {
      fileinto "Bills";
    }

    # 10. Scoped FR | Fileinto + Read (Subject)
    if anyof (
      header :comparator "i;unicode-casemap" :contains "Subject" ["__IGNORE__"],
      header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
    ) {
      fileinto "Bills";
      addflag "\\Seen";
    }

    # 11. Scoped FRS | Fileinto + Read + Stop (Subject)
    if anyof (
      header :comparator "i;unicode-casemap" :contains "Subject" ["__IGNORE__"],
      header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
    ) {
      fileinto "Bills";
      addflag "\\Seen";
      stop;
    }

    # 12. Scoped FRA | Fileinto + Read + Archive (Subject)
    if anyof (
      header :comparator "i;unicode-casemap" :contains "Subject" ["__IGNORE__"],
      header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
    ) {
      fileinto "Bills";
      addflag "\\Seen";
      fileinto "archive";
    }

    # 13. Scoped FRAS | Fileinto + Read + Archive + Stop (Subject)
    if anyof (
      header :comparator "i;unicode-casemap" :contains "Subject" ["__IGNORE__"],
      header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
    ) {
      fileinto "Bills";
      addflag "\\Seen";
      fileinto "archive";
      stop;
    }

    # 14. Scoped from:FRS | Fileinto + Read + Stop (From)
    if anyof (
      address :all :comparator "i;unicode-casemap" :contains ["From"] ["__IGNORE__"],
      address :all :comparator "i;unicode-casemap" :matches ["From"] ["__IGNORE__"]
    ) {
      fileinto "Bills";
      addflag "\\Seen";
      stop;
    }

    # 15. Scoped from:FRAS | Fileinto + Read + Archive + Stop (From)
    if anyof (
      address :all :comparator "i;unicode-casemap" :contains ["From"] ["__IGNORE__"],
      address :all :comparator "i;unicode-casemap" :matches ["From"] ["__IGNORE__"]
    ) {
      fileinto "Bills";
      addflag "\\Seen";
      fileinto "archive";
      stop;
    }

    # 16. Scoped Fx1 | Fileinto + Expire 1 Day (Subject)
    if anyof (
      header :comparator "i;unicode-casemap" :contains "Subject" ["__IGNORE__"],
      header :comparator "i;unicode-casemap" :matches "Subject" ["__IGNORE__"]
    ) {
      fileinto "Bills";
      expire "day" "1";
      stop;
    }
}

}

